/* Layout and component styling for the overhauled UI */
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0;}
html,body{height:100%;}
::selection{background:var(--color-text);color:var(--color-bg);}
body{display:flex;flex-direction:column;background:var(--color-bg);color:var(--color-text);font:var(--font-body);}
main{flex:1;display:flex;flex-direction:column;}

/* Preview area */
.preview{position:relative;flex:1;overflow:hidden;background:var(--color-bg);}
.preview video{width:100%;height:100%;object-fit:cover;transform:rotateY(180deg);transition:filter .2s;}
.preview #upload-preview{display:none;max-width:100%;max-height:100%;object-fit:contain;}

/* Shutter */
.shutter{position:absolute;bottom:var(--space-5);left:50%;transform:translateX(-50%);width:96px;height:96px;border-radius:50%;background:var(--color-surface);border:4px solid var(--color-primary);display:flex;align-items:center;justify-content:center;box-shadow:0 4px 12px rgba(0,0,0,.6);transition:transform .15s,background .15s;}
.shutter::after{content:'';position:absolute;inset:-8px;border-radius:50%;border:4px solid var(--color-primary);opacity:.2;}
.shutter .icon{font-size:48px;color:var(--color-primary);}
.shutter:hover{transform:translateX(-50%) scale(1.05);}
.shutter:active{transform:translateX(-50%) scale(.93);}

/* Source controls */
.source-controls{position:absolute;top:var(--space-3);left:var(--space-3);display:flex;gap:var(--space-2);}
.source-controls label{cursor:pointer;}
.source-controls label,.source-controls button{min-width:44px;}

/* Mode controls */
.controls{display:flex;gap:var(--space-2);padding:var(--space-3);background:var(--color-surface);align-items:center;justify-content:center;border-top:1px solid var(--color-border);}
.controls select,.controls textarea{background:var(--color-bg);color:var(--color-text);border:1px solid var(--color-border);border-radius:var(--radius-md);padding:var(--space-2);min-height:44px;}
.controls select{width:160px;}
.controls textarea{flex:1;}

/* Gallery */
.gallery{background:var(--color-surface);border-top:1px solid var(--color-border);padding:var(--space-3);overflow-x:auto;}
.gallery ul{display:flex;gap:var(--space-3);}
.gallery li{position:relative;width:120px;height:120px;flex:none;border-radius:var(--radius-sm);overflow:hidden;border:1px solid var(--color-border);display:flex;}
.gallery li img{width:100%;height:100%;object-fit:cover;}
.gallery li .photo{flex:1;}
.gallery .empty{font:var(--font-body);opacity:.6;}
.gallery li.isBusy img{filter:brightness(.4);}
.gallery li.isBusy::before{content:'';position:absolute;inset:0;background:linear-gradient(90deg,transparent,rgba(255,255,255,.15),transparent);background-size:200% 100%;animation:shimmer 2s infinite;}
.gallery li.isBusy::after{content:'Applying editâ€¦';position:absolute;bottom:var(--space-2);left:50%;transform:translateX(-50%);font:var(--font-caption);color:var(--color-on-primary);}
.photo-actions{position:absolute;bottom:var(--space-1);right:var(--space-1);display:flex;gap:var(--space-1);}

/* Export */
.export{padding:var(--space-3);text-align:center;background:var(--color-surface);border-top:1px solid var(--color-border);}
#gif-result img{max-width:100%;}

/* Lightbox */
.lightbox{position:fixed;inset:0;background:rgba(0,0,0,.9);display:none;align-items:center;justify-content:center;z-index:100;}
.lightbox.is-open{display:flex;}
.lightbox img{max-width:92vw;max-height:92vh;border-radius:var(--radius-lg);box-shadow:var(--elevation-3);}
.lightbox-close{position:absolute;top:var(--space-3);right:var(--space-3);width:44px;height:44px;border-radius:50%;background:var(--color-bg);border:1px solid var(--color-border);color:var(--color-text);display:flex;align-items:center;justify-content:center;font-size:24px;}
.lightbox-actions{position:absolute;bottom:var(--space-4);display:flex;gap:var(--space-2);}

@keyframes shimmer{0%{background-position:-200% 0;}100%{background-position:200% 0;}}

@media (prefers-reduced-motion:reduce){*{transition:none!important;animation:none!important;}}
